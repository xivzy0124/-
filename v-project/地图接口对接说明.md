# 地图数据接口对接完成说明

## 已完成的工作

### 后端接口开发

1. **DTO类** - `MapDataDTO.java`
   - 位置: `c:\Users\Administrator\-\v-end\src\main\java\org\v\end\model\dto\MapDataDTO.java`
   - 用于地图数据的传输对象

2. **服务接口** - `MapDataService.java`
   - 位置: `c:\Users\Administrator\-\v-end\src\main\java\org\v\end\service\MapDataService.java`
   - 定义了地图数据获取的接口方法

3. **服务实现** - `MapDataServiceImpl.java`
   - 位置: `c:\Users\Administrator\-\v-end\src\main\java\org\v\end\service\impl\MapDataServiceImpl.java`
   - 实现了从阿里云 DataV API 获取地图数据的功能

4. **控制器** - `MapDataController.java`
   - 位置: `c:\Users\Administrator\-\v-end\src\main\java\org\v\end\controller\MapDataController.java`
   - 提供了 RESTful API 接口

5. **配置类** - `RestTemplateConfig.java`
   - 位置: `c:\Users\Administrator\-\v-end\src\main\java\org\v\end\config\RestTemplateConfig.java`
   - 配置了 RestTemplate 用于 HTTP 请求

### 前端对接

1. **API请求函数** - `requestFuntion.js`
   - 位置: `c:\Users\Administrator\-\v-project\src\api\requestFuntion.js`
   - 添加了以下函数：
     - `getChinaMap()` - 获取中国地图数据
     - `getProvinceMap(adcode)` - 获取省份地图数据
     - `getCityMap(adcode)` - 获取城市地图数据
     - `getRegionNames(adcode)` - 获取区域名称列表

2. **组件修改** - `ChinaMap.vue`
   - 位置: `c:\Users\Administrator\-\v-project\src\components\tvecharts\ChinaMap.vue`
   - 修改了 `loadMapData` 函数，调用后端接口获取地图数据
   - 修改了 `startRandomHighlight` 函数，调用后端接口获取区域名称

## 接口列表

### 1. 获取中国地图数据
- **URL**: `GET /api/map/china`
- **返回**: 中国地图的 GeoJSON 数据

### 2. 获取省份地图数据
- **URL**: `GET /api/map/province/{adcode}`
- **参数**: adcode - 省份的行政区划代码
- **返回**: 省份地图的 GeoJSON 数据

### 3. 获取城市地图数据
- **URL**: `GET /api/map/city/{adcode}`
- **参数**: adcode - 城市的行政区划代码
- **返回**: 城市地图的 GeoJSON 数据

### 4. 获取区域名称列表
- **URL**: `GET /api/map/regions/{adcode}`
- **参数**: adcode - 区域的行政区划代码
- **返回**: 区域名称列表

## 服务状态

### 后端服务
- **状态**: 运行中
- **地址**: http://127.0.0.1:8080
- **端口**: 8080

### 前端服务
- **状态**: 运行中
- **本地地址**: http://localhost:3001/
- **网络地址**: http://192.168.201.251:3001/

## 测试步骤

1. **测试后端接口**
   ```powershell
   Invoke-WebRequest -Uri "http://127.0.0.1:8080/api/map/china" -Method GET -UseBasicParsing
   ```

2. **测试前端页面**
   - 在浏览器中打开: http://localhost:3001/
   - 查看地图是否正常加载
   - 测试地图点击功能
   - 测试随机高亮功能

3. **测试地图交互**
   - 点击省份，查看是否能够加载下级地图
   - 点击返回按钮，查看是否能够返回上一级
   - 测试键盘快捷键功能（数字键1和数字键2）

## 接口返回格式

所有接口返回统一的 Result 格式：
```json
{
  "code": 200,
  "message": "操作成功",
  "data": {
    "type": "FeatureCollection",
    "features": [...]
  }
}
```

## 注意事项

1. 后端服务从阿里云 DataV API 获取地图数据，需要网络连接
2. 前端配置的 API 地址为 `http://192.168.201.251:8080/`，如果需要修改，请编辑 `src/api/request.js`
3. 如果其他电脑无法访问，请检查防火墙设置和网络配置
4. 地图数据包含台湾省、香港特别行政区、澳门特别行政区，这些区域在随机高亮时会被过滤

## 错误处理

接口已实现完善的错误处理机制：
- 网络请求超时处理
- API 返回数据格式验证
- 异常捕获和日志记录
- 统一的错误响应格式
